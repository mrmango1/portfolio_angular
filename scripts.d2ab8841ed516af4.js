function createTree(){treeJSON=d3.json("./assets/flare.json",function(T){var s,v=0,S=0,f=750,p=$(window).width(),m=$(window).height();$(window).resize(function(){p=$(window).width(),m=$(window).height()});var d=d3.layout.tree(),w=d3.svg.diagonal().projection(function(e){return[e.y,e.x]});!function _(e,n,r){if(e){n(e);var a=r(e);if(a)for(var l=a.length,o=0;o<l;o++)_(a[o],n,r)}}(T,function(e){v=Math.max(e.name.length,v)},function(e){return e.children&&e.children.length>0?e.children:null});var u=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",function M(){i.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),W=d3.select("#tree-container").append("svg").attr("width","100%").attr("height","100%").attr("class","overlay").call(u);function C(e){e.children&&(e._children=e.children,e._children.forEach(C),e.children=null)}var Y=function(e){selectedNode=e,E()},B=function(e){selectedNode=null,E()},E=function(){var e=[];null!==draggingNode&&null!==selectedNode&&(e=[{source:{x:selectedNode.y0,y:selectedNode.x0},target:{x:draggingNode.y0,y:draggingNode.x0}}]);var n=i.selectAll(".templink").data(e);n.enter().append("path").attr("class","templink").attr("d",d3.svg.diagonal()).attr("pointer-events","none"),n.attr("d",d3.svg.diagonal()),n.exit().remove()};function A(e){scale=u.scale(),x=-e.y0,y=-e.x0,x=x*scale+p/2,y=y*scale+m/2,d3.select("g").transition().duration(f).attr("transform","translate("+x+","+y+")scale("+scale+")"),u.scale(scale),u.translate([x,y])}function G(e){b(e=function D(e){return e.children?(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null),e}(e)),A(e)}function b(e){var n=[1],r=function(t,c){c.children&&c.children.length>0&&(n.length<=t+1&&n.push(0),n[t+1]+=c.children.length,c.children.forEach(function(J){r(t+1,J)}))};r(0,s);var a=25*d3.max(n),l=(d=d.size([a,p])).nodes(s).reverse(),o=d.links(l);l.forEach(function(t){t.y=t.depth*(10*v)}),node=i.selectAll("g.node").data(l,function(t){return t.id||(t.id=++S)});var g=node.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("click",G);g.append("circle").attr("class","nodeCircle").attr("r",5).style("fill",function(t){return t._children?"lightsteelblue":""}),g.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("class","nodeText").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",0),g.append("circle").attr("class","ghostCircle").attr("r",30).attr("opacity",.2).style("fill","red").attr("pointer-events","mouseover").on("mouseover",function(t){Y(t)}).on("mouseout",function(t){B(t)}),node.select("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}),node.select("circle.nodeCircle").attr("r",2).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),node.transition().duration(f).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).select("text").style("fill-opacity",1);var h=node.exit().transition().duration(f).attr("transform",function(t){return"translate("+e.y+","+e.x+")"}).remove();h.select("circle").attr("r",0),h.select("text").style("fill-opacity",0);var k=i.selectAll("path.link").data(o,function(t){return t.target.id});k.enter().insert("path","g").attr("class","link").attr("d",function(t){var c={x:e.x0,y:e.y0};return w({source:c,target:c})}),k.transition().duration(f).attr("d",w),k.exit().transition().duration(f).attr("d",function(t){var c={x:e.x,y:e.y};return w({source:c,target:c})}).remove(),l.forEach(function(t){t.x0=t.x,t.y0=t.y})}var i=W.append("g");u.scale(1.7),(s=T).x0=m/2,s.y0=0,function N(e){e.children&&(e.children.forEach(N),C(e))}(s),b(s),A(s)})}